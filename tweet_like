// X (Twitter) Otomatik Begeni Scripti - GELISTIRILMIS VERSIYON
// Kullanim: Bir kullanicinin profil sayfasinda tarayici consoluna yapistirin

let begeniSayisi = 0;
let calisiyor = true;
let begenilenTweetler = new Set();
const MAX_ID_SAYISI = 500;

// Rastgele sure olustur
function rastgeleSure(minSaniye, maxSaniye) {
    const min = minSaniye * 1000;
    const max = maxSaniye * 1000;
    return Math.floor(Math.random() * (max - min + 1)) + min;
}

async function bekle(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
}

// Smooth scroll - insan gibi kaydirma
async function smoothScroll(mesafe) {
    return new Promise(resolve => {
        const baslangic = window.scrollY;
        const hedef = baslangic + mesafe;
        const sure = 800 + Math.random() * 400; // 800-1200ms arasi
        const baslangicZamani = performance.now();
        
        function animasyon(simdikiZaman) {
            const gecenSure = simdikiZaman - baslangicZamani;
            const ilerleme = Math.min(gecenSure / sure, 1);
            
            // Ease-in-out efekti (insan benzeri)
            const easing = ilerleme < 0.5
                ? 2 * ilerleme * ilerleme
                : 1 - Math.pow(-2 * ilerleme + 2, 2) / 2;
            
            const yeniPozisyon = baslangic + (mesafe * easing);
            window.scrollTo(0, yeniPozisyon);
            
            if (ilerleme < 1) {
                requestAnimationFrame(animasyon);
            } else {
                resolve();
            }
        }
        
        requestAnimationFrame(animasyon);
    });
}

// Tweet'in benzersiz kimligini al
function getTweetId(article) {
    const link = article.querySelector('a[href*="/status/"]');
    if (link) {
        const match = link.href.match(/\/status\/(\d+)/);
        return match ? match[1] : null;
    }
    return null;
}

// ID listesi cok buyuduyse eski ID'leri temizle
function idListesiniTemizle() {
    if (begenilenTweetler.size > MAX_ID_SAYISI) {
        const idArray = Array.from(begenilenTweetler);
        const yeniIDler = idArray.slice(-250);
        begenilenTweetler = new Set(yeniIDler);
        console.log('>>> ID listesi temizlendi. Yeni boyut: ' + begenilenTweetler.size);
    }
}

// Tweet'in zaten begenilmis olup olmadigini kontrol et
function tweetBegenilmisMi(article) {
    const unlikeButton = article.querySelector('[data-testid="unlike"]');
    if (unlikeButton) {
        return true;
    }
    
    const likeButton = article.querySelector('[data-testid="like"]');
    if (!likeButton) {
        return true;
    }
    
    const svg = likeButton.querySelector('svg');
    if (svg) {
        const path = svg.querySelector('path');
        if (path) {
            const d = path.getAttribute('d');
            if (d && d.includes('M20.884 13.19')) {
                return true;
            }
        }
    }
    
    return false;
}

// Ekrandaki gorulur tweetleri al
function getGorulenTweetler() {
    const articles = document.querySelectorAll('article[data-testid="tweet"]');
    const gorulenler = [];
    
    const ekranYuksekligi = window.innerHeight;
    const ustSinir = window.scrollY;
    const altSinir = ustSinir + ekranYuksekligi;
    
    articles.forEach(article => {
        const rect = article.getBoundingClientRect();
        const articleYPozisyonu = rect.top + window.scrollY;
        
        // Tweet ekranda gorunuyorsa
        if (articleYPozisyonu >= ustSinir - 200 && articleYPozisyonu <= altSinir + 200) {
            gorulenler.push(article);
        }
    });
    
    return gorulenler;
}

async function tweetleriBegen() {
    console.log('===========================================');
    console.log('SCRIPT BASLATILDI! (GELISTIRILMIS VERSIYON)');
    console.log('===========================================');
    console.log('✓ Smooth scroll aktif (insan benzeri)');
    console.log('✓ Ekrandaki tweetler oncelikli');
    console.log('✓ Bekleme: 10-15 saniye rastgele');
    console.log('✓ Her 10 begenide 30 saniye mola');
    console.log('Durdurmak icin: calisiyor = false');
    console.log('===========================================');
    console.log('');
    
    while (calisiyor) {
        idListesiniTemizle();
        
        // Her 10 begenide bir 30 saniye mola
        if (begeniSayisi > 0 && begeniSayisi % 10 === 0) {
            console.log('');
            console.log('###################################');
            console.log('### 10 BEGENI TAMAMLANDI! ###');
            console.log('### 30 SANIYE MOLA ###');
            console.log('###################################');
            console.log('');
            await bekle(30000);
            console.log('>>> MOLA BITTI, DEVAM EDILIYOR <<<');
            console.log('');
        }
        
        // Ekrandaki gorulur tweetleri al
        const gorulenTweetler = getGorulenTweetler();
        
        console.log('>>> Ekranda ' + gorulenTweetler.length + ' gorulur tweet var (Bellekteki ID: ' + begenilenTweetler.size + ')');
        
        if (gorulenTweetler.length === 0) {
            console.log('!!! HATA: Tweet bulunamadi, smooth scroll yapiliyor...');
            await smoothScroll(600);
            await bekle(2000);
            continue;
        }
        
        let tweetBegendi = false;
        let atlanmaSayisi = 0;
        
        // Ekrandaki her tweeti kontrol et
        for (let i = 0; i < gorulenTweetler.length; i++) {
            const article = gorulenTweetler[i];
            const tweetId = getTweetId(article);
            
            console.log('  [' + (i+1) + '/' + gorulenTweetler.length + '] Tweet kontrol ediliyor... ID: ' + (tweetId || 'BULUNAMADI'));
            
            // Eger bu tweet daha once begenildiyse, atla
            if (tweetId && begenilenTweetler.has(tweetId)) {
                console.log('    -> ATLANDI: Onceden begenilmis (ID kontrolu)');
                atlanmaSayisi++;
                continue;
            }
            
            // Tweet'in begenilmis olup olmadigini kontrol et
            if (tweetBegenilmisMi(article)) {
                console.log('    -> ATLANDI: Zaten begenilmis (DOM kontrolu)');
                if (tweetId) {
                    begenilenTweetler.add(tweetId);
                }
                atlanmaSayisi++;
                continue;
            }
            
            // Like butonu bul
            const likeButton = article.querySelector('[data-testid="like"]');
            
            if (likeButton) {
                console.log('    -> BEGENILEBILIR TWEET BULUNDU!');
                console.log('    -> Begenme islemi yapiliyor...');
                
                // Butona tikla
                likeButton.click();
                
                // Begeni sonrasi bekleme
                await bekle(500);
                
                // Basarili mi kontrol et
                const unlikeCheck = article.querySelector('[data-testid="unlike"]');
                if (unlikeCheck) {
                    begeniSayisi++;
                    if (tweetId) {
                        begenilenTweetler.add(tweetId);
                    }
                    const sonrakiMola = 10 - (begeniSayisi % 10);
                    console.log('    *** BASARILI! Tweet begenildi! ***');
                    console.log('    *** TOPLAM BEGENI: ' + begeniSayisi + ' ***');
                    console.log('    *** Sonraki mola: ' + sonrakiMola + ' begeni sonra ***');
                    tweetBegendi = true;
                    break;
                } else {
                    console.log('    !!! UYARI: Begeni islemi basarisiz olabilir');
                }
            } else {
                console.log('    -> ATLANDI: Begeni butonu bulunamadi');
                atlanmaSayisi++;
            }
        }
        
        // Eger ekrandaki tum tweetler kontrol edildiyse
        if (!tweetBegendi) {
            console.log('');
            console.log('>>> Ekrandaki ' + gorulenTweetler.length + ' tweet kontrol edildi');
            console.log('>>> Atlanan: ' + atlanmaSayisi);
            
            // Eger hepsi atlandiysa, daha fazla kaydir
            if (atlanmaSayisi === gorulenTweetler.length) {
                console.log('>>> TUM TWEETLER BEGENILMIS! Daha fazla asagi kaydiriliyor...');
                const buyukKaydir = 1200 + Math.floor(Math.random() * 400);
                console.log('--- Smooth scroll yapiliyor (' + buyukKaydir + 'px) ---');
                await smoothScroll(buyukKaydir);
            } else {
                console.log('>>> Yeni tweetler icin smooth scroll yapiliyor...');
                const kaydirmaMiktari = 500 + Math.floor(Math.random() * 300);
                console.log('--- Smooth scroll yapiliyor (' + kaydirmaMiktari + 'px) ---');
                await smoothScroll(kaydirmaMiktari);
            }
        } else {
            // Tweet begendiyse kucuk bir scroll yap
            console.log('');
            console.log('--- Mini smooth scroll (yeni tweetler icin) ---');
            const miniKaydir = 200 + Math.floor(Math.random() * 200);
            await smoothScroll(miniKaydir);
        }
        
        // Rastgele bekleme - 10-15 saniye arasi
        const beklemeSuresi = rastgeleSure(10, 15);
        const saniye = (beklemeSuresi / 1000).toFixed(1);
        console.log('--- ' + saniye + ' saniye bekleniyor ---');
        console.log('');
        await bekle(beklemeSuresi);
        
        // Sayfa sonuna gelip gelmedigini kontrol et
        if ((window.innerHeight + window.scrollY) >= document.body.offsetHeight - 100) {
            console.log('>>> Sayfa sonuna gelindi, yeni icerik bekleniyor...');
            await bekle(3000);
        }
    }
    
    console.log('');
    console.log('===========================================');
    console.log('SCRIPT DURDURULDU');
    console.log('Toplam begeni: ' + begeniSayisi);
    console.log('Bellekteki ID: ' + begenilenTweetler.size);
    console.log('===========================================');
}

// Scripti baslat
tweetleriBegen();

// Durdurmak icin konsola yaz: calisiyor = false
